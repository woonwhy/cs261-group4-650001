<!-- status.html -->
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>สถานะคำร้อง</title>
    <link rel="stylesheet" href="../css/stylesstatus.css">
<body>
    <div class="container">
        <nav class="navbar">
            <!-- Navbar Content -->
        </nav>

        <div class="content">
            <div class="main-content">
                <h2>คำร้องจากนักศึกษาคณะวิทยาศาสตร์</h2>
                <div id="requests-container"></div>
            </div>
        </div>
    </div>    <div class="container">
        <nav class="navbar">
            <div class="left">
                <img src="../img/tu-logo.png" alt="Logo" class="logo">
                <span>มหาวิทยาลัยธรรมศาสตร์</span>
            </div>

            <div class="menu">
                <a href="home.html">หน้าหลัก</a>
                <div class="dropdown">
                    <a href="#">เขียนคำร้อง</a>
                    <div class="dropdown-content">
                        <a href="form1.html">จดทะเบียนล่าช้า/เพิ่มล่าช้า</a>
                        <a href="form2.html">ขอถอนรายวิชา(Drop W)</a>
                        <a href="form3.html">จดทะเบียนศึกษารายวิชาข้ามโครงการ</a>
                        <a href="form4.html">คำร้องขอลาออก</a>
                    </div>
                </div>
                <a href="example.html">ภาพตัวอย่าง</a>
                <a href="status.html">สถานะคำร้อง</a>
                <a href="../index.html" class="user-icon">
                    <img src="../img/iconlogout.png" alt="User" class="user-icon-img">
                  </a>
            </div>
        </nav>

     
    </div>
    <footer class="footer">
        <div class="footer-content">
            <div class="box">
                <a href="home.html">หน้าหลัก</a>
            </div>
            <div class="box">
                <a href="#">เขียนคำร้อง</a>
                <a href="form1.html">เขียนคำร้องเพิ่ม-ถอน</a>
                <a href="form2.html">เขียนคำร้องขอถอนรายวิชา</a>
                <a href="form3.html">เขียนคำร้องจดทะเบียนรายวิชาข้ามโครงการ</a>
                <a href="form4.html">เขียนคำร้องขอลาออก</a>
            </div>
            <div class="box">
                <a href="status.html">สถานะคำร้อง</a>
            </div>
            <div class="box">
                <a href="example.html">ภาพตัวอย่าง</a>
            </div>
            <div class="box">
                <p>ติดต่อ</p>
                <p>Tel : +(66)61-971-8337</p>
                <p>Line ID : getgetmung</p>
                <p>E-mail : chayanon.pur@dome.tu.ac.th</p>
            </div>
        </div>
    </footer>    

    <script>
    document.addEventListener("DOMContentLoaded", function () {
        loadRequests();
    });

    function loadRequests() {
        const requestsContainer = document.getElementById("requests-container");
        requestsContainer.innerHTML = ""; // เคลียร์ข้อมูลเก่าก่อน

        const requests = JSON.parse(localStorage.getItem("requests")) || [];

        requests.forEach((request, index) => {
            const requestCard = document.createElement("div");
            requestCard.className = "status-card";
            requestCard.innerHTML = `
                <p>วันที่จดทะเบียน: ${request.registrationDate} | เรื่อง: "${request.title}" |สถานะคำร้อง: "${request.status}"</p>
                 <p>Email ผู้ใช้: ${request.email}</p>
                <button onclick="submitRequest(${index})">Submit</button>
            `;
            requestsContainer.appendChild(requestCard);
        });
    }

    function submitRequest(index) {
    const requests = JSON.parse(localStorage.getItem("requests"));
    const formData = requests[index];

    // อัปเดตสถานะคำร้อง
    requests[index].status = "กำลังดำเนินการ";
    localStorage.setItem("requests", JSON.stringify(requests));

    // เตรียมข้อมูลฟอร์มเพื่อส่งไปยัง PHP
    fetch('send_email.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: new URLSearchParams(formData).toString()
    })
    .then(response => response.text())
    .then(result => {
        alert(result); // แสดงข้อความตอบกลับจาก PHP
        location.reload();
    })
    .catch(error => console.error('Error:', error));
}
</script>
</body>
