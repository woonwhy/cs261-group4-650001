<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>สถานะคำร้อง</title>
    <link rel="stylesheet" href="../css/stylesstatus.css">
</head>
<body>
    <div class="container">
    <div class="navbar">
        <div class="left">
            <img src="../img/tu-logo.png" alt="Logo" class="logo">
            <span>มหาวิทยาลัยธรรมศาสตร์</span>
        </div>
            <div class="menu">
                <a href="home.html">หน้าหลัก</a>
                <div class="dropdown">
                <a href="#">เขียนคำร้อง</a>
                        <div class="dropdown-content">
                            <a href="form1.html">จดทะเบียนล่าช้า/เพิ่มล่าช้า</a>
                            <a href="form2.html">ขอถอนรายวิชา (Drop W)</a>
                            <a href="form3.html">จดทะเบียนศึกษารายวิชาข้ามโครงการ</a>
                            <a href="form4.html">คำร้องขอลาออก</a>
                        </div>
                </div>
                <a href="example.html">ภาพตัวอย่าง</a>
                <a href="status.html">สถานะคำร้อง</a>
                <button class="logout-btn" onclick="logout()">Logout</button>
        
            </div>
    </div>

        <div class="content2">
            <h1>คำร้องจากนักศึกษาคณะวิทยาศาสตร์</h1>    
            <div class="status-box">
                <p><strong>วันที่จดทะเบียน:</strong> 14/11/2567</p>
            <p><strong>เรื่อง:</strong> "คำร้องขอจดทะเบียนเพิ่ม-ถอนล่าช้า"</p>
            <p><strong>สถานะคำร้อง:</strong> <span class="status-text">กำลังดำเนินการ</span></p>
                <div class="buttons">
                    <button class="view-btn">view</button>
                    <button class="cancel-btn">cancel</button>
                </div>
                <a href="example.html">ภาพตัวอย่าง</a>
                <a href="status.html">สถานะคำร้อง</a>
                <a href="../index.html" class="user-icon">
                    <img src="../img/iconlogout.png" alt="User" class="user-icon-img">
                  </a>
            </div>
        </div>   
    </div>   

    <footer class="footer">
        <div class="footer-content">
            <div class="copyright">
                Copyright © 2024
            </div>
            <div class="social-links">
                <div class="social-links-title">Connect</div>
                <div class="social-icons">
                    <a href="https://www.facebook.com/chiaa.nedchaina.56/"><img src="../img/facebook.png" alt="Facebook"></a>
                    <a href="https://www.instagram.com/yoxxa.g/?hl=th"><img src="../img/instagram.png" alt="Instagram"></a>
                    <a href="https://mail.google.com/mail/u/2/#inbox?compose=GTvVlcSKjgLCffZrTtcBNHSStSrtgQnhNFjPtJfSccvcDpSXHkvtjmRSDMwNpPSVCjzKlDvHMCJNs"><img src="../img/gmail.png" alt="Gmail"></a>
                </div>
            </div>
            <div class="contact-info">
                <div>ติดต่อเพิ่มเติม</div>
                <div>Tel : +(66)61-971-8337</div>
                <div>Line ID : getgetmung</div>
                <div>E-mail : chayanon.pur@dome.tu.ac.th</div>
            </div>
        </div>
    </footer>    

    <script>
    document.addEventListener("DOMContentLoaded", function () {
        loadRequests();
    });

    function loadRequests() {
        const requestsContainer = document.getElementById("requests-container");
        requestsContainer.innerHTML = ""; // เคลียร์ข้อมูลเก่าก่อน

        const requests = JSON.parse(localStorage.getItem("requests")) || [];

        requests.forEach((request, index) => {
            const requestCard = document.createElement("div");
            requestCard.className = "status-card";
            requestCard.innerHTML = `
                <p>วันที่จดทะเบียน: ${request.registrationDate} | เรื่อง: "${request.title}" |สถานะคำร้อง: "${request.status}"</p>
                 <p>Email ผู้ใช้: ${request.email}</p>
                <button onclick="submitRequest(${index})">Submit</button>
            `;
            requestsContainer.appendChild(requestCard);
        });
    }

    function submitRequest(index) {
    const requests = JSON.parse(localStorage.getItem("requests"));
    const formData = requests[index];

    // อัปเดตสถานะคำร้อง
    requests[index].status = "กำลังดำเนินการ";
    localStorage.setItem("requests", JSON.stringify(requests));

    // เตรียมข้อมูลฟอร์มเพื่อส่งไปยัง PHP
    fetch('send_email.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: new URLSearchParams(formData).toString()
    })
    .then(response => response.text())
    .then(result => {
        alert(result); // แสดงข้อความตอบกลับจาก PHP
        location.reload();
    })
    .catch(error => console.error('Error:', error));
}
</script>
<script>
    // ฟังก์ชันสำหรับออกจากระบบ
    function logout() {
        sessionStorage.removeItem("isLoggedIn"); //เราใช้ sessionStorage ใช่มะ
        // รีไดเร็กต์ไปที่หน้า login
        window.location.href = "../index.html";  // เปลี่ยนไปหน้า login หรือหน้าอื่นๆ ที่ต้องการ
    }
</script>
</body>
</html>
